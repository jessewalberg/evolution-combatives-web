You are building the web admin dashboard for Evolution Combatives, a React Native tactical training app.

IMPORTANT: For detailed development rules, patterns, and guidelines, always reference the comprehensive rules file at CLAUDE_DEVELOPMENT_RULES.md in the project root. This file contains current project analysis, architecture patterns, security requirements, and implementation guidelines.

Project Context

Platform: Next.js 15 with App Router, TypeScript, and Tailwind CSS
Backend: Supabase (shared with React Native app)
Video Management: Cloudflare Stream API (NOT react-native package)
Data Fetching: TanStack Query with Next.js experimental features
Purpose: Video content management, user administration, analytics, Q&A moderation
Users: Super admins, content admins, support admins

Shared Database Schema
Uses the EXACT same Supabase database as the React Native app:

Core Tables:
profiles: Enhanced with badge_number, department, rank, admin_role
subscriptions: Tiers are 'beginner' ($9), 'intermediate' ($19), 'advanced' ($49)
disciplines: Law Enforcement, Jiu Jitsu, Wrestling, Striking
categories: Subcategories within each discipline
videos: Full metadata with cloudflare_video_id, tier_required, processing_status
user_progress: Watch time, completion, bookmarks
questions/answers: Q&A system for intermediate/advanced tiers
admin_activity: Audit logging for all admin actions
video_access_logs: Security monitoring
Subscription Tiers (CRITICAL - Use These Exactly):
typescript
type SubscriptionTier = 'beginner' | 'intermediate' | 'advanced'
Admin Roles:
typescript
type AdminRole = 'super_admin' | 'content_admin' | 'support_admin'
Design System Requirements
CRITICAL: Must perfectly complement the React Native app design:

Colors (Exact Match Required):
typescript
const colors = {
  primary: {
    500: '#2563EB', // Main brand blue
    400: '#3B82F6',
    600: '#1D4ED8',
  },
  neutral: {
    950: '#0A0A0A', // Background
    900: '#171717', // Cards
    800: '#262626', // Hover states
    700: '#404040', // Borders
    400: '#A3A3A3', // Secondary text
    50: '#FAFAFA',  // Primary text
  },
  success: { 500: '#10B981' },
  error: { 500: '#EF4444' },
  warning: { 500: '#F59E0B' },
}
Typography:
Font Family: Inter (matching mobile app exactly)
Headings: H1 (2.25rem), H2 (1.875rem), H3 (1.5rem), H4 (1.25rem)
Body: Large (1.125rem), Base (1rem), Small (0.875rem)
Weights: 400 (normal), 500 (medium), 600 (semibold), 700 (bold)
Spacing (8px Grid System):
typescript
const spacing = {
  1: '4px',   // 0.25rem
  2: '8px',   // 0.5rem  
  3: '12px',  // 0.75rem
  4: '16px',  // 1rem
  5: '20px',  // 1.25rem
  6: '24px',  // 1.5rem
  8: '32px',  // 2rem
  10: '40px', // 2.5rem
  12: '48px', // 3rem
  16: '64px', // 4rem
}
Component Styling Guidelines:
Cards: Dark theme (bg-neutral-900) with subtle borders
Buttons: Professional appearance, proper hover states
Tables: Zebra striping, proper spacing, sortable headers
Forms: Clear labels, error states, professional validation
Navigation: Sidebar with role-based menu items
Modals: Overlay with backdrop blur, center positioning
Video Management Architecture
Storage: Cloudflare R2 for raw video files
Streaming: Cloudflare Stream for optimized delivery
API Integration: Direct Cloudflare Stream API calls via fetch
Upload Flow: Admin uploads → R2 → Stream processing → Database metadata
Security: Signed URLs for video access based on user subscription tier
Processing: Real-time status updates via webhooks
File Structure (Current)
app/
├── auth/                      # ✅ Authentication pages
│   ├── confirm/
│   └── layout.tsx
├── dashboard/                 # ✅ Comprehensive dashboard implemented
│   ├── content/               # ✅ Full content management system
│   │   ├── categories/        # ✅ Category management
│   │   ├── disciplines/       # ✅ Discipline management  
│   │   ├── processing/        # ✅ Video processing status
│   │   └── videos/            # ✅ Video library with upload/edit
│   └── page.tsx              # ✅ Dashboard overview with metrics
├── users/                     # ✅ User management pages
├── analytics/                 # ✅ Comprehensive analytics dashboard
├── qa/                        # ✅ Q&A management system
├── subscribe/                 # ✅ Subscription management
├── login/                     # ✅ Login implementation
└── api/                       # ✅ Comprehensive API routes
    ├── admin/content/         # ✅ Admin content endpoints
    ├── cloudflare/            # ✅ Cloudflare integration
    ├── content/               # ✅ Content CRUD operations
    ├── video-processing/      # ✅ Video processing endpoints
    ├── video/                 # ✅ Video signed URL generation
    ├── subscriptions/         # ✅ Stripe integration
    └── webhooks/              # ✅ Cloudflare & Stripe webhooks

src/
├── components/
│   ├── ui/                    # ✅ Complete UI component system
│   ├── layout/                # ✅ AdminLayout implemented
│   ├── user/                  # ✅ UserTable component
│   └── video/                 # ✅ Video management components
├── lib/
│   ├── shared/                # ✅ Shared utilities and types
│   ├── supabase-browser.ts   # ✅ Client-side Supabase
│   ├── supabase.ts           # ✅ Server-side Supabase
│   ├── query-client.ts       # ✅ TanStack Query setup
│   └── utils.ts              # ✅ Utility functions
├── services/
│   ├── cloudflare-stream.ts  # ✅ Cloudflare Stream service
│   ├── content.ts            # ✅ Content management service
│   └── content-client.ts     # ✅ Client-side content service
├── hooks/
│   └── useAuth.ts            # ✅ Authentication hook
├── providers/
│   └── QueryProvider.tsx    # ✅ TanStack Query provider
└── theme/                    # ✅ Design system implementation
    ├── colors.ts
    ├── spacing.ts
    └── typography.ts
Import Patterns
Shared types: import { type VideoWithRelations } from 'shared/types/database'
UI components: import { Button } from '../../src/components/ui/button'
Services: import { clientContentService } from '../../src/services/content-client'
Utils: import { cn } from '../../src/lib/utils'
Supabase Browser: import { createClientComponentClient } from '../../src/lib/supabase-browser'
Supabase Server: import { createServerClient } from '../../src/lib/supabase'
Query Keys: import { queryKeys } from '../../src/lib/query-client'
Auth Hook: import { useAuth } from '../../src/hooks/useAuth'
Theme: import { colors } from '../../src/theme/colors'
Code Standards
App Router: Use server components where beneficial, client components for interactivity
TanStack Query: All client-side data fetching with proper hydration
Server Actions: For mutations when appropriate (form submissions)
TypeScript: Strict mode, proper interfaces, no any types
Tailwind: All styling with 8px spacing grid, no custom CSS
Error Boundaries: Proper loading and error states
Optimistic Updates: Better admin UX with immediate feedback
Security: Admin role validation, input sanitization, XSS prevention
TanStack Query Patterns
typescript
// Query for data fetching
const { data: videos, isLoading } = useQuery({
  queryKey: ['videos', filters],
  queryFn: () => videoService.getVideos(filters),
  staleTime: 5 * 60 * 1000, // 5 minutes
})

// Mutation for data modification
const updateVideoMutation = useMutation({
  mutationFn: videoService.updateVideo,
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['videos'] })
    toast.success('Video updated successfully')
  },
  onError: (error) => {
    toast.error(`Failed to update video: ${error.message}`)
  },
})
Admin Role System & Permissions
super_admin:
Full access to everything
User management and admin role assignment
System settings and configuration
Financial data and subscription management
Security settings and audit logs
content_admin:
Video upload and content management
Content organization (disciplines, categories)
Basic analytics (content performance)
Q&A moderation (view only)
support_admin:
User management and support
Subscription management (view/modify)
Q&A moderation (answer questions)
Basic analytics (user engagement)
Component Implementation Guidelines
When creating UI components:
Use design tokens: Import from theme system, never hardcode colors/spacing
TypeScript interfaces: Proper prop typing with JSDoc documentation
Accessibility: ARIA labels, keyboard navigation, screen reader support
Error states: Handle loading, error, and empty states appropriately
Mobile responsive: Works on desktop and tablet, follows responsive design
Performance: Use React.memo for expensive components, avoid unnecessary re-renders
When building features:
Role-based access: Check admin permissions before rendering sensitive content
Real-time updates: Use Supabase subscriptions for live data where appropriate
Optimistic updates: Update UI immediately, handle errors gracefully
Audit logging: Track all admin actions for security and compliance
Input validation: Client and server-side validation with proper error messages
Integration with Mobile App
Real-time sync: Admin changes appear in mobile app immediately
Shared data: Same database, same subscription tiers, same user accounts
Content flow: Admin uploads → Mobile app displays
User management: Admin subscription changes → Mobile app access control
Q&A flow: Mobile submission → Admin moderation → Mobile notification
Security Requirements
Authentication: Admin-only access with role verification
Authorization: Route-level and component-level permission checking
Input validation: Sanitize all user inputs, prevent XSS/injection
File uploads: Validate file types, sizes, scan for malware
API security: Rate limiting, request validation, proper error handling
Audit trails: Log all admin actions with timestamps and user identification
Performance Guidelines
Server components: Use for static content and initial data loading
Client components: Only when interactivity is required
Code splitting: Dynamic imports for heavy components
Image optimization: Use Next.js Image component for all images
Caching: Appropriate cache headers and TanStack Query configuration
Bundle size: Monitor and optimize JavaScript bundle size
Key Implementation Priorities
Complete design system matching mobile app exactly
Video upload interface with drag & drop and progress tracking
Content organization tools for disciplines, categories, videos
Advanced analytics with charts and real-time data
Q&A moderation system for intermediate/advanced tier support
Real-time notifications for admin actions and system events
Error Handling Patterns
typescript
// Standard error handling
try {
  const result = await someOperation()
  toast.success('Operation completed successfully')
  return result
} catch (error) {
  console.error('Operation failed:', error)
  toast.error(error instanceof Error ? error.message : 'Operation failed')
  throw error
}
Toast Notification Standards
Success: Green, brief message, auto-dismiss
Error: Red, detailed message, manual dismiss
Warning: Orange, important information, auto-dismiss
Info: Blue, general information, auto-dismiss
Always consider the admin user experience: these are professional users who need efficient, reliable tools for managing a tactical training platform. Every interface should feel professional, secure, and purpose-built for administrative tasks.

When building any feature, ask:

Which admin role should access this?
How does this integrate with the mobile app?
Are proper error handling and loading states included?
Is the professional, tactical brand maintained?
Does this require real-time updates?
Are security and audit requirements met?
